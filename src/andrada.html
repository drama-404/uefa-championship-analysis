htmlt7 = '''
<!-- Bootstrap -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<!-- Style -->
<style>
	.andradutza {
		font-family: "Times New Roman", Times, serif;
	}
	.svg-container {
		display: inline-block;
		position: relative;
		width: 100%;
		padding-bottom: 100%;
		vertical-align: top;
		overflow: hidden;
	}
	.svg-content {
		display: inline-block;
		position: absolute;
		top: 0;
		left: 0;
	}

	line#limit {
	stroke: #f7b227;
	stroke-width: 2;
	stroke-dasharray: 8 5;
	}

	text.divergence {
	font-size: 14px;
	fill: #000000;
	}

	text.value {
	font-size: 20px;
	fill: #000000;
	}

	.slider {
	-webkit-appearance: none; 
	appearance: none;
	width: 10%; 
	height: 15px; 
	background: #e7e7e7; 
	outline: none;
	opacity: 0.7; 
	border-radius: 6px;
	-webkit-transition: .2s; 
	transition: opacity .2s;
	}

	/* Mouse-over effects */
	.slider:hover {
	opacity: 1;
	}

	.slider::-webkit-slider-thumb {
	-webkit-appearance: none; /* Override default look */
	appearance: none;
	width: 15px; /* Set a specific slider handle width */
	height: 15px; /* Slider handle height */
	background: #1ACEE6; /* Green background */
	cursor: round; /* Cursor on hover */
	border-radius: 6px;
	}

	div.tooltip-donut {
		position: absolute;
		text-align: center;
		padding: .3rem;
		background: #FFFFFF;
		color: #000000;
		border: 1px solid #000000;
		border-radius: 8px;
		pointer-events: none;
		font-size: 0.8rem;
	}

</style>

<img id="baseimg" src="usa.png" style="display:none" />
<div class="andradutza">
	<center><h1>Educational Products Overview</h1></center>
	<center><h4>-Median Product Engagement in a Year-</h4></center>
	<center><h6>(excluding legal holidays)</h6></center>
    <div class="row">
		<div id="map7" class="svg-container"></div>
	</div>
</div>
'''


<script>
require.config({
  paths: {
    d3src: "https://d3js.org/",
  },
  map: {
    '*': {
      'd3v6': 'd3src/d3.v6.min',
      'd3-selection': 'd3src/d3-selection.v1.min',
      'd3-drag': 'd3src/d3-drag.v1.min',
      'd3-shape': 'd3src/d3-shape.v1.min',
      'd3-path': 'd3src/d3-path.v1.min',
      'd3-dispatch': 'd3src/d3-dispatch.v1.min',
      'd3-annotation': 'https://cdnjs.cloudflare.com/ajax/libs/d3-annotation/2.5.1/d3-annotation.min.js',
    }
  }
});

require(["d3v6", "d3-annotation"], function(d3, d3Annotation) {

// Inject d3Annotation methods to d3
for (var key in d3Annotation) {
  d3[key] = d3Annotation[key];
}

// Get Assets URL set by Kaggle
const baseAssetsUrl = document.getElementById('baseimg').src.replace(/usa.png.*$/, '');

// Set the SVG area
const margin = { LEFT: 30, RIGHT: 30, TOP: 10, BOTTOM: 30 }
const width = 950 - margin.LEFT - margin.RIGHT
const height = 900 - margin.TOP - margin.BOTTOM

const svg = d3.select("#map7").append("svg")
  // .attr("style", "outline: thin solid red;")
  .attr("preserveAspectRatio", "xMinYMin meet")
  .attr("viewBox", "0 0 950 900")
  .classed("svg-content", true)
  .attr("transform",
   `translate(${margin.LEFT}, ${margin.TOP})`)


// === Bar ===
d3.csv(baseAssetsUrl + "proverview.csv").then(function(data){ 

  data.forEach(d => {
    d.engagement_index = Number(d.engagement_index)
  })

  const defs = svg.append('defs');

  const bgGradient = defs
    .append('linearGradient')
    .attr('id', 'bg-gradient3')
    .attr('gradientTransform', 'rotate(90)');
  bgGradient
    .append('stop')
    .attr('stop-color', '#9bf8f4')
    .attr('offset', '0%');
  bgGradient
    .append('stop')
    .attr('stop-color', '#6f7bf7')
    .attr('offset', '100%');

  // Scales
  const x = d3.scaleBand()
    .range([0, width/1.1])
    .domain(data.map(d => d.name))
    .paddingInner(0.3)
    .paddingOuter(0.2)

  const y = d3.scaleLinear()
    .range([height/4, 0])
    .domain([0, d3.max(data, d => d.engagement_index)])

  const xAxisGroup = svg.append("g")
    .attr("class", "x axis")
    .attr("transform", `translate(60, ${width/1.86})`)

  const yAxisGroup = svg.append("g")
    .attr("class", "y axis")
    .attr("transform", `translate(50, ${width/3.5})`)

  // Axis
  const xAxisCall = d3.axisBottom(x)
  xAxisGroup.call(xAxisCall)
    .selectAll("text")
      .attr("y", "0")
      .attr("x", "-10")
      .attr("text-anchor", "end")
      .attr("font-size", "12px")
      .attr("transform", "rotate(-50)")

  const yAxisCall = d3.axisLeft(y)
    .ticks(7)
    .tickFormat(d => d)
  yAxisGroup.call(yAxisCall)
    .selectAll("text")

  // Bar Chart
  const rects = svg.selectAll()
    .data(data)
    .enter().append('g')
    .append("rect")
    .attr("transform", `translate(50, ${width/3.5})`)
    .attr("y", d => y(d.engagement_index))
    .attr("x", d => x(d.name))
    .attr('rx', 5)
    .attr('ry', 4)
    .attr("width", x.bandwidth)
    .attr("height", d => height/4 - y(d.engagement_index))
    .style("fill", "url(#bg-gradient3)")
    .style("stroke-width", "1px")


  // Interactive
  var div = d3.select("body").append("div")
    .attr("class", "tooltip-donut")
    .style("opacity", 0);

  rects
    .on('mouseenter', function (event, dt) {
    // MOUSE ON
    d3.selectAll('.value')
          .attr('opacity', 0)

    d3.select(this)
        .transition()
        .duration(100)
        .attr('opacity', 0.3)
        .attr('x', (a) => x(a.name) - 2.5)
        .attr('width', x.bandwidth() + 5)

    // Add line
    const y_new = y(dt.engagement_index)
    var line = svg.append('line')
          .attr('id', 'limit')
          .attr('x1', 50)
          .attr('y1', y_new + 250)
          .attr('x2', 850)
          .attr('y2', y_new + 250)
          .attr('stroke', '#f7b227')

    // Makes the new div appear
    div.transition()
        .duration(50)
        .style("opacity", 1);
    let num = dt.engagement_index;
    div.html(num)
        .style("left", (event.pageX) + "px")
        .style("top", (event.pageY-30) + "px");


  })
    // MOUSE LEAVE
    .on('mouseleave', function () {
      d3.selectAll('.value')
          .attr('opacity', 1)

      d3.select(this)
      .transition()
      .duration(100)
      .attr('opacity', 1)
      .attr('x', (a) => x(a.name))
      .attr('width', x.bandwidth())

      // New div dissapears
      div.transition()
          .duration('50')
          .style("opacity", 0);

      svg.selectAll('#limit').remove()
      svg.selectAll('.divergence').remove()
    })


  // Google Docs
  svg.append("image")
  .attr("xlink:href", baseAssetsUrl + "googledocs.png")
  .attr("x", "5%")
  .attr("y", "1%")
  .attr("width", 50)
  .attr("height", 50)
  .style("opacity", 1);

  svg.append("text")
      .attr("x", "7.5%")
      .attr("y", "8.5%")
      .attr("font-size", "14px")
      .attr("text-anchor", "middle")
      .attr("font-weight", 600)
      .text("Google Docs")
  svg.append("text")
      .attr("x", "8.5%")
      .attr("y", "8.5%")
      .attr("dy", "1.5em")
      .attr("font-size", "11.5px")
      .attr("text-anchor", "middle")
      .attr("font-weight", 100)
      .text("Create and edit text docs")
  svg.append("text")
      .attr("x", "8.5%")
      .attr("y", "8.5%")
      .attr("dy", "2.5em")
      .attr("font-size", "11.5px")
      .attr("text-anchor", "middle")
      .attr("font-weight", 100)
      .text("right in your web browser.")

   svg.append("svg:defs").append("svg:marker")
   .attr("id", "triangle")
   .attr("refX", 6)
   .attr("refY", 6)
   .attr("markerWidth", 30)
   .attr("markerHeight", 30)
   .attr("markerUnits","userSpaceOnUse")
   .attr("orient", "auto")
   .append("path")
   .attr("d", "M 0 0 12 6 0 12 3 6")
   .style("fill", "#4E4E4E");
   svg.append("path")
   // bottom, top
     .attr('d', d3.line()([[75, 120], [75, 240]]))
     .attr("stroke-width", 2)
     .attr("stroke", "#4E4E4E")
     .attr("marker-end", "url(#triangle)");


  // Youtube
  svg.append("image")
  .attr("xlink:href", baseAssetsUrl + "youtube.png")
  .attr("x", "5%")
  .attr("y", "82%")
  .attr("width", 150)
  .attr("height", 150)
  .style("opacity", 1);
      
  svg.append("text")
  .attr("x", "13%")
  .attr("y", "94.5%")
  .attr("font-size", "14px")
  .attr("text-anchor", "middle")
  .attr("font-weight", 600)
  .text("Youtube")
svg.append("text")
  .attr("x", "13.5%")
  .attr("y", "94.5%")
  .attr("dy", "1.5em")
  .attr("font-size", "11.5px")
  .attr("text-anchor", "middle")
  .attr("font-weight", 100)
  .text("Provides various teaching videos")
svg.append("text")
  .attr("x", "13.5%")
  .attr("y", "94.5%")
  .attr("dy", "2.5em")
  .attr("font-size", "11.5px")
  .attr("text-anchor", "middle")
  .attr("font-weight", 100)
  .text("and helps the students learn.")

svg.append("path")
// bottom, top
  .attr('d', d3.line()([[120, 780], [120, 600]]))
  .attr("stroke-width", 2)
  .attr("stroke", "#4E4E4E")
  .attr("marker-end", "url(#triangle)");


// Classroom
svg.append("image")
.attr("xlink:href", baseAssetsUrl + "googleclassroom.png")
.attr("x", "15.5%")
.attr("y", "13%")
.attr("width", 60)
.attr("height", 60)
.style("opacity", 1);

svg.append("text")
  .attr("x", "18.5%")
  .attr("y", "21%")
  .attr("font-size", "14px")
  .attr("text-anchor", "middle")
  .attr("font-weight", 600)
  .text("Google Classroom")
svg.append("text")
  .attr("x", "18.5%")
  .attr("y", "21%")
  .attr("dy", "1.5em")
  .attr("font-size", "11.5px")
  .attr("text-anchor", "middle")
  .attr("font-weight", 100)
  .text("Your central place where")
svg.append("text")
.attr("x", "18.5%")
.attr("y", "21%")
.attr("dy", "2.5em")
.attr("font-size", "11.5px")
.attr("text-anchor", "middle")
.attr("font-weight", 100)
.text("teaching and learning")
svg.append("text")
  .attr("x", "18.5%")
  .attr("y", "21%")
  .attr("dy", "3.5em")
  .attr("font-size", "11.5px")
  .attr("text-anchor", "middle")
  .attr("font-weight", 100)
  .text("come together.")

svg.append("path")
// bottom, top
  .attr('d', d3.line()([[170, 240], [170, 380]]))
  .attr("stroke-width", 2)
  .attr("stroke", "#4E4E4E")
  .attr("marker-end", "url(#triangle)");


// Drive
svg.append("image")
.attr("xlink:href", baseAssetsUrl + "googledrive.png")
.attr("x", "20%")
.attr("y", "73%")
.attr("width", 50)
.attr("height", 50)
.style("opacity", 1);

svg.append("text")
  .attr("x", "22%")
  .attr("y", "80%")
  .attr("font-size", "14px")
  .attr("text-anchor", "middle")
  .attr("font-weight", 600)
  .text("Google Drive")
svg.append("text")
  .attr("x", "22%")
  .attr("y", "80%")
  .attr("dy", "1.5em")
  .attr("font-size", "11.5px")
  .attr("text-anchor", "middle")
  .attr("font-weight", 100)
  .text("Save files online")
svg.append("text")
.attr("x", "22%")
.attr("y", "80%")
.attr("dy", "2.5em")
.attr("font-size", "11.5px")
.attr("text-anchor", "middle")
.attr("font-weight", 100)
.text("and access them")
svg.append("text")
  .attr("x", "22%")
  .attr("y", "80%")
  .attr("dy", "3.5em")
  .attr("font-size", "11.5px")
  .attr("text-anchor", "middle")
  .attr("font-weight", 100)
  .text("anywhere on any device.")

svg.append("path")
// bottom, top
  .attr('d', d3.line()([[215, 650], [215, 550]]))
  .attr("stroke-width", 2)
  .attr("stroke", "#4E4E4E")
  .attr("marker-end", "url(#triangle)");

// Kahoot
svg.append("image")
.attr("xlink:href", baseAssetsUrl + "kahoot.png")
.attr("x", "25%")
.attr("y", "28%")
.attr("width", 50)
.attr("height", 50)
.style("opacity", 1);

svg.append("text")
  .attr("x", "27.7%")
  .attr("y", "35.5%")
  .attr("font-size", "14px")
  .attr("text-anchor", "middle")
  .attr("font-weight", 600)
  .text("Kahoot!")
svg.append("text")
  .attr("x", "27.7%")
  .attr("y", "35.5%")
  .attr("dy", "1.5em")
  .attr("font-size", "11.5")
  .attr("text-anchor", "middle")
  .attr("font-weight", 100)
  .text("Game-based learning platform.")

  svg.append("path")
// bottom, top
  .attr('d', d3.line()([[265, 350], [265, 440]]))
  .attr("stroke-width", 2)
  .attr("stroke", "#4E4E4E")
  .attr("marker-end", "url(#triangle)");
});

// Note
const annotations = [
  {
  note: { 
    label: "Google products (like Google Docs, Classroom, Drive, Forms, Sheets and Meet), Youtube and Kahoot! are the most frequently used products in one year. \t Worth mentioning is that all the other products have very small median engagement compared to the mentioned ones.",
    title: "ðŸ“Œ Note",
    wrap: 250,  // smaller text splits in multiple lines
    padding: 10,   // More = text lower
    
  },
  color: ["#000000"],
  x: 630,
  y: 30,
  dy: 0,
  dx: 0
}]

const makeAnnotations = d3.annotation()
  .annotations(annotations)

svg.append("g")
.call(makeAnnotations)

});
</script>